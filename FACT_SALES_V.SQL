CREATE OR REPLACE VIEW FACT_SALES_V AS
SELECT 
SALES.PROD_ID,
SALES.CUST_ID,
SALES.TIME_ID,
SALES.CHANNEL_ID,
SALES.PROMO_ID,
SALES.QUANTITY_SOLD,
SALES.AMOUNT_SOLD,
CUSTOMERS.CUST_FIRST_NAME,
CUSTOMERS.CUST_LAST_NAME,
CUSTOMERS.CUST_FIRST_NAME||CUSTOMERS.CUST_LAST_NAME CUST_NAME,
COUNTRIES.COUNTRY_NAME,
COSTS.UNIT_COST,
COSTS.UNIT_PRICE,
CHANNELS.CHANNEL_DESC,
PROMOTIONS.PROMO_NAME,
PRODUCTS.PROD_NAME,
PRODUCTS.PROD_CATEGORY,
PRODUCTS.PROD_SUBCATEGORY,
SALES.PROD_ID||'~'||SALES.CUST_ID||'~'||SALES.TIME_ID||'~'||SALES.CHANNEL_ID||'~'||SALES.PROMO_ID INTEGRATION_ID,
DBMS_OBFUSCATION_TOOLKIT.md5(input => UTL_RAW.cast_to_raw(SALES.PROD_ID||'~'||SALES.CUST_ID||'~'||SALES.TIME_ID||'~'||SALES.CHANNEL_ID||'~'||SALES.PROMO_ID)) INTEGRATION_HASH,
SYSDATE W_INSERT_DT,
SYSDATE W_UPDATE_DT,
DBMS_OBFUSCATION_TOOLKIT.md5(input => UTL_RAW.cast_to_raw(SALES.PROD_ID||'~'||SALES.CUST_ID||'~'||SALES.TIME_ID||'~'||SALES.CHANNEL_ID||'~'||SALES.PROMO_ID||'~'||SALES.QUANTITY_SOLD||'~'||SALES.AMOUNT_SOLD||'~'||CUSTOMERS.CUST_FIRST_NAME||'~'||CUSTOMERS.CUST_LAST_NAME||'~'||COUNTRIES.COUNTRY_NAME||'~'||COSTS.UNIT_COST||'~'||COSTS.UNIT_PRICE||'~'||CHANNELS.CHANNEL_DESC||'~'||PROMOTIONS.PROMO_NAME||'~'||PRODUCTS.PROD_NAME||'~'||PRODUCTS.PROD_CATEGORY||'~'||PRODUCTS.PROD_SUBCATEGORY)) ROW_HASH
FROM SALES
LEFT JOIN COSTS ON SALES.PROD_ID=COSTS.PROD_ID AND SALES.TIME_ID=COSTS.TIME_ID AND SALES.PROMO_ID=COSTS.PROMO_ID AND SALES.CHANNEL_ID=COSTS.CHANNEL_ID
LEFT JOIN CHANNELS ON CHANNELS.CHANNEL_ID=SALES.CHANNEL_ID
LEFT JOIN PROMOTIONS ON PROMOTIONS.PROMO_ID=SALES.PROMO_ID
LEFT JOIN CUSTOMERS ON CUSTOMERS.CUST_ID=SALES.CUST_ID
LEFT JOIN COUNTRIES ON COUNTRIES.COUNTRY_ID=CUSTOMERS.COUNTRY_ID
LEFT JOIN PRODUCTS ON PRODUCTS.PROD_ID=SALES.PROD_ID
LEFT JOIN TIMES ON TIMES.TIME_ID=SALES.TIME_ID;
